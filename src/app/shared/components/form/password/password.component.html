<app-form-wrapper [label]="passwordLabel" [error]="passwordError" [inputId]="passwordInputId">
  <div class="input-group" #passwordContainer>
    <input
      [id]="passwordInputId"
      [type]="passwordFieldType"
      [placeholder]="passwordPlaceholder"
      [formControl]="passwordControl"
      class="form-control"
      [ngClass]="{
        'is-invalid': passwordError,
        'border-danger': passwordStrength.class === 'danger' && passwordValue && !passwordError,
        'border-warning': passwordStrength.class === 'warning' && passwordValue && !passwordError,
        'border-success': passwordStrength.class === 'success' && passwordValue && !passwordError
      }"
      (focus)="onPasswordFocus()"
      (blur)="onPasswordBlur()"
      (input)="onPasswordInput()"
    />
    <button 
      class="btn btn-outline-secondary" 
      type="button" 
      tabindex="-1"
      (click)="togglePasswordVisibility()"
      [attr.aria-label]="passwordFieldType === 'password' ? 'Mostrar senha' : 'Ocultar senha'">
      <mat-icon>{{passwordFieldType === 'password' ? 'visibility' : 'visibility_off'}}</mat-icon>
    </button>
    
    <div *ngIf="showCriteria" class="password-criteria" #criteriaElement
         [class.criteria-up]="criteriaPosition.up"
         [class.criteria-right]="criteriaPosition.right">
    <div class="criteria-header">
      <small class="text-muted">Critérios de segurança:</small>
    </div>
    <div class="criteria-list">
      <div class="criteria-item" [ngClass]="{ 'criteria-valid': passwordCriteria.hasMinLength }">
        <mat-icon [class]="passwordCriteria.hasMinLength ? 'text-success' : 'text-danger'">{{passwordCriteria.hasMinLength ? 'check_circle' : 'cancel'}}</mat-icon>
        <span>Mínimo 8 caracteres</span>
      </div>
      <div class="criteria-item" [ngClass]="{ 'criteria-valid': passwordCriteria.hasUppercase }">
        <mat-icon [class]="passwordCriteria.hasUppercase ? 'text-success' : 'text-danger'">{{passwordCriteria.hasUppercase ? 'check_circle' : 'cancel'}}</mat-icon>
        <span>Pelo menos uma letra maiúscula</span>
      </div>
      <div class="criteria-item" [ngClass]="{ 'criteria-valid': passwordCriteria.hasLowercase }">
        <mat-icon [class]="passwordCriteria.hasLowercase ? 'text-success' : 'text-danger'">{{passwordCriteria.hasLowercase ? 'check_circle' : 'cancel'}}</mat-icon>
        <span>Pelo menos uma letra minúscula</span>
      </div>
      <div class="criteria-item" [ngClass]="{ 'criteria-valid': passwordCriteria.hasNumber }">
        <mat-icon [class]="passwordCriteria.hasNumber ? 'text-success' : 'text-danger'">{{passwordCriteria.hasNumber ? 'check_circle' : 'cancel'}}</mat-icon>
        <span>Pelo menos um número</span>
      </div>
      <div class="criteria-item" [ngClass]="{ 'criteria-valid': passwordCriteria.hasSpecialChar }">
        <mat-icon [class]="passwordCriteria.hasSpecialChar ? 'text-success' : 'text-danger'">{{passwordCriteria.hasSpecialChar ? 'check_circle' : 'cancel'}}</mat-icon>
        <span>Pelo menos um caractere especial</span>
      </div>
    </div>
    
    <div *ngIf="passwordValue" class="alert password-strength-text-container py-1 px-2 mt-3" [ngClass]="'alert-' + passwordStrength.class">
      <small class="password-strength-text" [ngClass]="'text-' + passwordStrength.class">
         {{ passwordStrengthWithPrefix }}
      </small>
    </div>
    </div>
  </div>
</app-form-wrapper>

<div class="mb-2"></div>
<app-form-wrapper [label]="confirmPasswordLabel" [error]="confirmPasswordError" [inputId]="confirmPasswordInputId">
  <div class="input-group">
    <input
      [id]="confirmPasswordInputId"
      [type]="confirmPasswordFieldType"
      [placeholder]="confirmPasswordPlaceholder"
      [formControl]="confirmPasswordControl"
      class="form-control"
      [ngClass]="{
        'is-invalid': confirmPasswordError
      }"
    />
    <button 
      class="btn btn-outline-secondary" 
      type="button" 
      tabindex="-1"
      (click)="toggleConfirmPasswordVisibility()"
      [attr.aria-label]="confirmPasswordFieldType === 'password' ? 'Mostrar senha' : 'Ocultar senha'">
      <mat-icon>{{confirmPasswordFieldType === 'password' ? 'visibility' : 'visibility_off'}}</mat-icon>
    </button>
  </div>
</app-form-wrapper>