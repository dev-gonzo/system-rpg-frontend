<app-game-group-navigation activePage="search"></app-game-group-navigation>


<div class="row justify-content-center mb-4">
  <app-form-input-button
    [control]="searchControl"
    [label]="'PAGE.GAME_GROUP.SEARCH.TITLE' | translate"
    [placeholder]="'PAGE.GAME_GROUP.SEARCH.SEARCH_PLACEHOLDER' | translate"
    buttonIcon="mdi mdi-magnify"
    [buttonAriaLabel]="'PAGE.GAME_GROUP.SEARCH.TITLE' | translate"
    [buttonLoading]="isLoading()"
    (buttonClick)="onManualSearch($event)"
    [col]="12"
    [colLg]="6"
  />
</div>

<div class="row justify-content-center" *ngIf="currentSearchTerm()">
  <div class="col-8 col-lg-6">
    <small class="text-muted d-block text-center mb-3">
      {{ 'PAGE.GAME_GROUP.SEARCH.SEARCHING_FOR' | translate: {term: currentSearchTerm()} }}
    </small>
  </div>
</div>


<div class="row" *ngIf="isLoading()">
  <div class="col-12 text-center py-4">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">{{ 'PAGE.GAME_GROUP.SEARCH.LOADING' | translate }}</span>
    </div>
    <p class="mt-2">{{ 'PAGE.GAME_GROUP.SEARCH.LOADING' | translate }}</p>
  </div>
</div>


<div class="row" *ngIf="gameGroups().length > 0 && !isLoading()">
  <div *ngFor="let gameGroup of gameGroups()" class="col-12 col-md-6 col-lg-4 mb-3">
    <div class="card border-0 theme-surface">
      <div class="card-body p-4" style="cursor: pointer;" (click)="navigateToDetail(gameGroup.id)">
        <div class="d-flex gap-3 mb-3">
          <div>
            <span class="icon-circle icon-circle-xl theme-secondary">
              <mat-icon svgIcon="mdi-dice-d10"></mat-icon>
            </span>
          </div>

          <span class="h4" [title]="gameGroup.campaignName">
            {{ gameGroup.campaignName }}
          </span>
        </div>
        <p class="card-text text-muted">
          {{ gameGroup.gameSystem }}
          <span *ngIf="gameGroup.settingWorld">|
          {{ gameGroup.settingWorld }}</span>
        </p>
        <p class="card-text">
          {{ gameGroup.shortDescription }}
        </p>
      </div>
      <div class="card-footer d-flex justify-content-between">
        <div class="avatar-group" *ngIf="gameGroup.participants && gameGroup.participants.length > 0">
          <app-tooltip 
            *ngFor="let participant of gameGroup.participants" 
            [text]="('PAGE.GAME_GROUP.MY_GROUPS.TOOLTIP.PARTICIPANT_INFO' | translate: {username: participant.username, role: ('PAGE.GAME_GROUP.MY_GROUPS.ROLE.' + participant.role | translate)})"
            position="right"
            [autoCloseOnClick]="true"
            [autoCloseDelay]="1500"
            style="cursor: pointer; user-select: none;"
          >
            <span class="avatar-circle avatar-circle-sm" style="cursor: pointer; user-select: none;"> 
              {{ participant.username.substring(0, 2).toUpperCase() }}
            </span>
          </app-tooltip>
        </div>
        <div class="text-muted">
          <app-tooltip
            position="left"
            [text]="('PAGE.GAME_GROUP.MY_GROUPS.TOOLTIP.ACCESS_RULE_INFO' | translate: {accessRule: ('PAGE.GAME_GROUP.MY_GROUPS.ACCESS_RULE.' + gameGroup.accessRule | translate)})"
            [autoCloseOnClick]="true"
            [autoCloseDelay]="1500"
            style="cursor: pointer; user-select: none;"
          >
            <mat-icon [svgIcon]="getAccessRuleIcon(gameGroup.accessRule)" style="cursor: pointer; user-select: none;"></mat-icon>
          </app-tooltip>
        </div>
      </div>
    </div>
  </div>
</div>


<div class="row" *ngIf="gameGroups().length === 0 && !isLoading()">
  <div class="col-12">
    <div class="card border-0">
      <div class="card-body text-center py-5">
        <mat-icon svgIcon="mdi-magnify" class="display-1 text-muted mb-3"></mat-icon>
        <h5 class="text-muted mb-3">
          <span *ngIf="!currentSearchTerm()">
            {{ 'PAGE.GAME_GROUP.SEARCH.NO_SEARCH_YET' | translate }}
          </span>
          <span *ngIf="currentSearchTerm()">
            {{ 'PAGE.GAME_GROUP.SEARCH.NO_RESULTS_FOUND' | translate }}
          </span>
        </h5>
        <p class="text-muted">
          <span *ngIf="!currentSearchTerm()">
            {{ 'PAGE.GAME_GROUP.SEARCH.START_SEARCHING' | translate }}
          </span>
          <span *ngIf="currentSearchTerm()">
            {{ 'PAGE.GAME_GROUP.SEARCH.TRY_DIFFERENT_TERMS' | translate }}
          </span>
        </p>
      </div>
    </div>
  </div>
</div>